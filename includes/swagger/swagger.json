{
  "openapi": "3.0.0",
  "info": {
    "title": "TrinityKitWP API",
    "description": "API para gerenciamento de posts, pedidos personalizados e formulários de contato no WordPress",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "/wp-json/trinitykitcms-api/v1",
      "description": "API TrinityKitCMS"
    }
  ],
  "security": [
    {
      "ApiKeyAuth": []
    }
  ],
  "paths": {
    "/configs": {
      "get": {
        "summary": "Obter configurações do site",
        "description": "Retorna as configurações básicas do site WordPress",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Configurações obtidas com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "site_name": {
                          "type": "string",
                          "description": "Nome do site WordPress"
                        },
                        "site_description": {
                          "type": "string",
                          "description": "Descrição do site WordPress"
                        },
                        "whatsapp_url": {
                          "type": "string",
                          "description": "URL do WhatsApp para contato"
                        },
                        "google_analytics_id": {
                          "type": "string",
                          "description": "ID do Google Analytics"
                        },
                        "google_tag_manager_id": {
                          "type": "string",
                          "description": "ID do Google Tag Manager"
                        },
                        "frontend_app_url": {
                          "type": "string",
                          "description": "URL do aplicativo frontend"
                        },
                        "github_user": {
                          "type": "string",
                          "description": "Usuário do GitHub"
                        },
                        "github_repo": {
                          "type": "string",
                          "description": "Repositório do GitHub"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Erro de autenticação",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "invalid_api_key"
                    },
                    "message": {
                      "type": "string",
                      "example": "API Key inválida ou não fornecida"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 401
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/contact-form/submit": {
      "post": {
        "summary": "Enviar formulário de contato",
        "description": "Cria um novo registro de contato no WordPress com suporte para upload de arquivos. Todos os campos são obrigatórios exceto o arquivo anexo.",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "email",
                  "phone",
                  "message",
                  "tag"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Nome do contato (obrigatório)",
                    "example": "Lucas Trindade"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email do contato (obrigatório)",
                    "example": "trindade@thetrinityweb.com.br"
                  },
                  "phone": {
                    "type": "string",
                    "description": "Telefone do contato (obrigatório)",
                    "example": "(11) 99999-9999"
                  },
                  "linkedin": {
                    "type": "string",
                    "description": "Perfil do LinkedIn do contato (opcional)",
                    "example": "https://linkedin.com/in/usuario"
                  },
                  "message": {
                    "type": "string",
                    "description": "Mensagem do contato (obrigatório)",
                    "example": "Gostaria de mais informações sobre seus produtos."
                  },
                  "tag": {
                    "type": "string",
                    "description": "Tag para categorizar o contato (obrigatório)",
                    "example": "orçamento"
                  },
                  "attachment": {
                    "type": "string",
                    "format": "binary",
                    "description": "Arquivo anexo (opcional). Formatos permitidos: PDF, XLS, XLSX, CSV, DOC, DOCX, JPG, JPEG, PNG, GIF, SVG, WEBP. Tamanho máximo: 10MB",
                    "example": "arquivo.pdf"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Formulário enviado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Formulário enviado com sucesso"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Erro de validação",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "invalid_name_data"
                        },
                        "message": {
                          "type": "string",
                          "example": "Nome não pode estar vazio"
                        },
                        "data": {
                          "type": "object",
                          "properties": {
                            "status": {
                              "type": "integer",
                              "example": 400
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "invalid_file_type"
                        },
                        "message": {
                          "type": "string",
                          "example": "Tipo de arquivo não permitido"
                        },
                        "data": {
                          "type": "object",
                          "properties": {
                            "status": {
                              "type": "integer",
                              "example": 400
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "file_too_large"
                        },
                        "message": {
                          "type": "string",
                          "example": "Arquivo muito grande. Tamanho máximo permitido: 10MB"
                        },
                        "data": {
                          "type": "object",
                          "properties": {
                            "status": {
                              "type": "integer",
                              "example": 400
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Erro de autenticação",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "invalid_api_key"
                    },
                    "message": {
                      "type": "string",
                      "example": "API Key inválida ou não fornecida"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 401
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "submission_failed"
                    },
                    "message": {
                      "type": "string",
                      "example": "Falha ao enviar formulário"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 500
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/post-slugs": {
      "get": {
        "summary": "Listar posts",
        "description": "Retorna uma lista de posts publicados com seus detalhes. Pode ser limitado por quantidade ou paginado.",
        "parameters": [
          {
            "name": "quantity",
            "in": "query",
            "required": false,
            "description": "Quantidade total de posts a retornar. Se não especificado, retorna todos os posts.",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "required": false,
            "description": "Quantidade de posts por página para paginação. Se especificado, ignora o parâmetro quantity.",
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "page",
            "in": "query",
            "required": false,
            "description": "Número da página desejada (começa em 1). Só tem efeito se per_page for especificado.",
            "schema": {
              "type": "integer",
              "default": 1
            }
          }
        ],
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de posts obtida com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "slug": {
                            "type": "string",
                            "description": "Slug do post"
                          },
                          "title": {
                            "type": "string",
                            "description": "Título do post"
                          },
                          "content": {
                            "type": "string",
                            "description": "Conteúdo completo do post"
                          },
                          "excerpt": {
                            "type": "string",
                            "description": "Resumo do post"
                          },
                          "created_at": {
                            "type": "string",
                            "format": "date-time",
                            "description": "Data de criação do post"
                          },
                          "featured_image_url": {
                            "type": "string",
                            "description": "URL da imagem destacada do post"
                          }
                        }
                      }
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de posts existentes",
                      "example": 50
                    },
                    "total_pages": {
                      "type": "integer",
                      "description": "Número total de páginas disponíveis (quando usando paginação)",
                      "example": 5
                    },
                    "current_page": {
                      "type": "integer",
                      "description": "Número da página atual (quando usando paginação)",
                      "example": 1
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Erro de autenticação",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "invalid_api_key"
                    },
                    "message": {
                      "type": "string",
                      "example": "API Key inválida ou não fornecida"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 401
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/post/{slug}": {
      "get": {
        "summary": "Obter post por slug",
        "description": "Retorna os detalhes de um post específico usando seu slug",
        "parameters": [
          {
            "name": "slug",
            "in": "path",
            "required": true,
            "description": "Slug do post que deseja buscar",
            "schema": {
              "type": "string"
            }
          }
        ],
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Post encontrado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "slug": {
                          "type": "string",
                          "description": "Slug do post"
                        },
                        "title": {
                          "type": "string", 
                          "description": "Título do post"
                        },
                        "content": {
                          "type": "string",
                          "description": "Conteúdo completo do post"
                        },
                        "excerpt": {
                          "type": "string",
                          "description": "Resumo do post"
                        },
                        "created_at": {
                          "type": "string",
                          "format": "date-time",
                          "description": "Data de criação do post"
                        },
                        "featured_image_url": {
                          "type": "string",
                          "description": "URL da imagem destacada do post"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Parâmetro slug não fornecido",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "slug_required"
                    },
                    "message": {
                      "type": "string",
                      "example": "O parâmetro slug é obrigatório"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 400
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Post não encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "post_not_found"
                    },
                    "message": {
                      "type": "string",
                      "example": "Post não encontrado"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 404
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Erro de autenticação",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "invalid_api_key"
                    },
                    "message": {
                      "type": "string",
                      "example": "API Key inválida ou não fornecida"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 401
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/orders": {
      "post": {
        "summary": "Criar novo pedido",
        "description": "Cria um novo pedido personalizado para uma criança",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "required": [
                  "childName",
                  "childAge",
                  "childGender", 
                  "skinTone",
                  "parentName",
                  "email",
                  "phone",
                  "photo"
                ],
                "properties": {
                  "coupon": {
                    "type": "string",
                    "description": "Código de cupom opcional a ser aplicado ao pedido",
                    "example": "TRINITY10"
                  },
                  "childName": {
                    "type": "string",
                    "description": "Nome da criança",
                    "example": "Luna Trindade"
                  },
                  "childAge": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 18,
                    "description": "Idade da criança (1-18 anos)",
                    "example": 8
                  },
                  "childGender": {
                    "type": "string",
                    "description": "Gênero da criança",
                    "enum": ["boy", "girl"],
                    "example": "girl"
                  },
                  "skinTone": {
                    "type": "string",
                    "description": "Tom de pele da criança",
                    "enum": ["light", "dark"],
                    "example": "light"
                  },
                  "parentName": {
                    "type": "string",
                    "description": "Nome do responsável",
                    "example": "Lucas Trindade"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "E-mail do responsável",
                    "example": "lucas@email.com"
                  },
                  "phone": {
                    "type": "string",
                    "description": "Telefone do responsável (formato: (99) 99999-9999)",
                    "pattern": "^\\(\\d{2}\\)\\s\\d{5}-\\d{4}$",
                    "example": "(11) 99999-9999"
                  },
                  "photo": {
                    "type": "string",
                    "format": "binary",
                    "description": "Foto do rosto da criança. Formatos: JPG, JPEG, PNG. Tamanho máximo: 5MB"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Pedido criado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Pedido criado com sucesso"
                    },
                    "order_id": {
                      "type": "integer",
                      "example": 123
                    },
                    "status": {
                      "type": "string",
                      "example": "created"
                    },
                    "applied_coupon": {
                      "type": ["string", "null"],
                      "description": "Cupom aplicado no pedido, se informado",
                      "example": "TRINITY10"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Erro de validação",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "missing_fields"
                        },
                        "message": {
                          "type": "string",
                          "example": "Todos os campos são obrigatórios"
                        },
                        "data": {
                          "type": "object",
                          "properties": {
                            "status": {
                              "type": "integer",
                              "example": 400
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "invalid_phone"
                        },
                        "message": {
                          "type": "string",
                          "example": "Telefone inválido. Use o formato (99) 99999-9999"
                        },
                        "data": {
                          "type": "object",
                          "properties": {
                            "status": {
                              "type": "integer",
                              "example": 400
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "coupon_not_found"
                        },
                        "message": {
                          "type": "string",
                          "example": "Cupom inválido ou não encontrado."
                        },
                        "data": {
                          "type": "object",
                          "properties": {
                            "status": {
                              "type": "integer",
                              "example": 400
                            }
                          }
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Erro de autenticação",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "invalid_api_key"
                    },
                    "message": {
                      "type": "string",
                      "example": "API Key inválida ou não fornecida"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 401
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "order_creation_failed"
                    },
                    "message": {
                      "type": "string",
                      "example": "Erro ao criar o pedido"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 500
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/orders/book-details": {
      "get": {
        "summary": "Obter detalhes do livro mais recente",
        "description": "Retorna informações básicas do livro mais recente publicado no sistema, incluindo ID, nome e preço. Este endpoint não requer autenticação e busca automaticamente o livro mais recente baseado na data de publicação.",
        "security": [],
        "responses": {
          "200": {
            "description": "Detalhes do livro obtidos com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "integer",
                          "description": "ID do livro no WordPress",
                          "example": 123
                        },
                        "nome": {
                          "type": "string",
                          "description": "Nome/título do livro",
                          "example": "Aventuras de João"
                        },
                        "preco": {
                          "type": "number",
                          "format": "float",
                          "description": "Preço do livro em reais (R$)",
                          "example": 29.90
                        }
                      }
                    },
                    "message": {
                      "type": "string",
                      "example": "Detalhes do livro encontrados com sucesso"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Nenhum livro publicado encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": "string",
                      "example": "Nenhum livro publicado encontrado"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": "string",
                      "example": "Erro interno do servidor: [mensagem de erro]"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/orders/{order_id}/pix": {
      "post": {
        "summary": "Criar pagamento PIX para um pedido",
        "description": "Cria um pagamento PIX para um pedido existente usando a API do Asaas",
        "parameters": [
          {
            "name": "order_id",
            "in": "path",
            "required": true,
            "description": "ID do pedido para criar o pagamento PIX",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Pagamento PIX criado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Pix criado com sucesso"
                    },
                    "pix_key_id": {
                      "type": "string",
                      "description": "ID da chave PIX gerada",
                      "example": "pix_123456789"
                    },
                    "qr_code_image": {
                      "type": "string",
                      "description": "Imagem do QR Code PIX em base64",
                      "example": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."
                    },
                    "qr_code_copypaste": {
                      "type": "string",
                      "description": "Código PIX para copiar e colar",
                      "example": "00020126580014BR.GOV.BCB.PIX0136..."
                    },
                    "price": {
                      "type": "number",
                      "format": "float",
                      "description": "Preço do livro em reais (R$)",
                      "example": 49.99
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro ao criar pagamento PIX",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "asaas_pix_key_error"
                    },
                    "message": {
                      "type": "string",
                      "example": "Erro ao criar chave PIX: [mensagem de erro]"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 500
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/orders/check-coupon": {
      "get": {
        "summary": "Validar cupom e retornar preço atualizado",
        "description": "Valida um cupom para um pedido e retorna o preço atualizado",
        "parameters": [
          {
            "name": "coupon",
            "in": "query",
            "required": true,
            "description": "Código do cupom (case-insensitive)",
            "schema": { "type": "string" },
            "example": "TRINITY10"
          },
          {
            "name": "book_id",
            "in": "query",
            "required": true,
            "description": "ID do livro (post type book_templates)",
            "schema": { "type": "integer" },
            "example": 123
          }
        ],
        "responses": {
          "200": {
            "description": "Cupom válido, preço calculado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "price": { "type": "number", "format": "float", "example": 39.90 }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Erro de validação ou cupom inválido",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": { "type": "string", "example": "coupon_invalid" },
                    "message": { "type": "string", "example": "Cupom inválido: percentual de desconto não configurado corretamente." },
                    "data": { "type": "object", "properties": { "status": { "type": "integer", "example": 400 } } }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Pedido ou cupom não encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": { "type": "string", "example": "coupon_not_found" },
                    "message": { "type": "string", "example": "Cupom inválido ou não encontrado." },
                    "data": { "type": "object", "properties": { "status": { "type": "integer", "example": 404 } } }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/webhook/payment-confirm": {
      "post": {
        "summary": "Webhook de confirmação de pagamento",
        "description": "Endpoint para receber notificações de confirmação de pagamento do Asaas. Atualiza o status do pedido para pago e registra os dados da transação.",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["event", "payment"],
                "properties": {
                  "id": {
                    "type": "string",
                    "description": "ID do evento"
                  },
                  "event": {
                    "type": "string",
                    "description": "Tipo do evento",
                    "enum": ["PAYMENT_RECEIVED"]
                  },
                  "dateCreated": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Data de criação do evento"
                  },
                  "payment": {
                    "type": "object",
                    "required": ["id", "externalReference", "paymentDate", "value"],
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "ID da transação de pagamento"
                      },
                      "externalReference": {
                        "type": "string",
                        "description": "ID do pedido no WordPress"
                      },
                      "paymentDate": {
                        "type": "string",
                        "format": "date",
                        "description": "Data do pagamento"
                      },
                      "value": {
                        "type": "number",
                        "example": 49.99,
                        "description": "Valor do pagamento"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Webhook processado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Webhook processado com sucesso"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Dados do webhook inválidos",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Evento inválido"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Pedido não encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Pedido não encontrado"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/orders/{order_id}/payment-status": {
      "get": {
        "summary": "Verificar status do pagamento",
        "description": "Verifica se um pedido específico já foi pago",
        "parameters": [
          {
            "name": "order_id",
            "in": "path",
            "required": true,
            "description": "ID do pedido para verificar o status do pagamento",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Status do pagamento obtido com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "description": "Mensagem descritiva do status",
                      "example": "Pedido já foi pago"
                    },
                    "status": {
                      "type": "string",
                      "description": "Status do pagamento",
                      "enum": ["paid", "pending"],
                      "example": "paid"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Pedido não encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "order_not_found"
                    },
                    "message": {
                      "type": "string",
                      "example": "Pedido não encontrado"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 404
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/webhook/send-thanks": {
      "get": {
        "summary": "Webhook para envio de emails de agradecimento",
        "description": "Endpoint que verifica pedidos com status 'paid', envia emails de agradecimento e atualiza o status para 'thanked'",
        "responses": {
          "200": {
            "description": "Processamento concluído com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "description": "Mensagem de sucesso com número de pedidos processados",
                      "example": "Processamento concluído. 5 pedidos processados."
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "email_sending_failed"
                    },
                    "message": {
                      "type": "string",
                      "example": "Erro ao enviar email de agradecimento"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "integer",
                          "example": 500
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/webhook/generate-text-assets": {
      "get": {
        "summary": "Gerar textos personalizados em lote",
        "description": "Processa todos os pedidos no status 'thanked' para gerar textos personalizados usando Deepseek API",
        "responses": {
          "200": {
            "description": "Textos gerados com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Processamento concluído. 5/5 pedidos processados"
                    },
                    "processed": {
                      "type": "integer",
                      "example": 5
                    },
                    "total": {
                      "type": "integer",
                      "example": 5
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro no processamento",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": false
                    },
                    "message": {
                      "type": "string",
                      "example": "Processamento concluído. 3/5 pedidos processados"
                    },
                    "processed": {
                      "type": "integer",
                      "example": 3
                    },
                    "total": {
                      "type": "integer",
                      "example": 5
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "example": "Erro no pedido #123: Modelo de livro não encontrado"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "security": [{"ApiKeyAuth": []}]
      }
    },
    "/webhook/initiate-faceswap": {
      "get": {
        "summary": "Iniciar processo de face swap em lote",
        "description": "Processa todos os pedidos no status 'created_assets_text' que ainda não tiveram o face swap iniciado. Para cada página do livro, inicia o processo de face swap na API externa e salva os IDs das tarefas retornadas.",
        "responses": {
          "200": {
            "description": "Processo de face swap iniciado com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Processamento de iniciação do face swap concluído. 3 pedidos processados."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos processados com sucesso",
                      "example": 3
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos encontrados",
                      "example": 3
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Lista de erros encontrados (vazia em caso de sucesso)",
                      "example": []
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro no processamento",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Processamento de iniciação do face swap concluído. 2 pedidos processados."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos processados com sucesso",
                      "example": 2
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos encontrados",
                      "example": 3
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "example": "Pedido #123: Imagem base não encontrada para página 1"
                      },
                      "description": "Lista detalhada de erros encontrados"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [{"ApiKeyAuth": []}]
      }
    },
    "/webhook/check-falai": {
      "get": {
        "summary": "Verificar status FAL.AI e processar imagens (Polling Fallback)",
        "description": "**ARQUIVO:** `webhook-check-falai.php` - **FALLBACK POLLING** - Usado como backup caso o webhook callback (`/webhook/falai-callback`) falhe ou não seja recebido. Verifica manualmente o status de tarefas FAL.AI pendentes. **QUANDO USAR:** Apenas como fallback; o callback automático é prioritário e mais rápido. **FUNCIONAMENTO:** Processa pedidos com 'created_assets_text' e 'falai_initiated = true', verificando páginas com 'falai_task_id' mas sem 'generated_illustration'. Consulta a API FAL.AI (`/fal-ai/nano-banana-pro/requests/{request_id}/status`), depois busca `response_url` para obter imagem final, baixa e atualiza ACF. Atualiza status para 'created_assets_illustration' quando completo. **RATE LIMIT:** 1.5s entre requisições. **SKIP_FACESWAP:** Copia ilustração base para páginas marcadas como skip. **Cron:** Executa de 5 em 5 minutos automaticamente.",
        "responses": {
          "200": {
            "description": "Verificação concluída com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Verificação de FAL.AI concluída. 2 pedidos finalizados."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos finalizados (status atualizado)",
                      "example": 2
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos verificados",
                      "example": 5
                    },
                    "elapsed_time": {
                      "type": "number",
                      "description": "Tempo de execução em segundos",
                      "example": 89.123
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Lista de erros encontrados",
                      "example": []
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro no processamento",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Verificação de FAL.AI concluída. 1 pedidos finalizados."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos finalizados",
                      "example": 1
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos verificados",
                      "example": 5
                    },
                    "elapsed_time": {
                      "type": "number",
                      "description": "Tempo de execução em segundos",
                      "example": 152.789
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "example": "Pedido #456: FAL.AI falhou para página 2 (Request ID: abc123)"
                      },
                      "description": "Lista detalhada de erros"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [{"ApiKeyAuth": []}]
      }
    },
    "/webhook/check-faceswap": {
      "get": {
        "summary": "Verificar status do face swap e processar imagens prontas",
        "description": "Processa todos os pedidos no status 'created_assets_text' que já tiveram o face swap iniciado (face_swap_initiated = true). Verifica o status das tarefas na API externa e processa as imagens que estão prontas, salvando-as no WordPress e atualizando o status do pedido quando todas as páginas estiverem concluídas.",
        "responses": {
          "200": {
            "description": "Verificação de face swap concluída com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Verificação de face swap concluída. 2 pedidos finalizados."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos finalizados (status atualizado para created_assets_illustration)",
                      "example": 2
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos verificados",
                      "example": 5
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Lista de erros encontrados (vazia em caso de sucesso)",
                      "example": []
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro no processamento",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Verificação de face swap concluída. 1 pedidos finalizados."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos finalizados",
                      "example": 1
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos verificados",
                      "example": 5
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "example": "Pedido #456: Face swap falhou para página 2 (Task ID: abc123)"
                      },
                      "description": "Lista detalhada de erros encontrados"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [{"ApiKeyAuth": []}]
      }
    },
    "/webhook/initiate-falai": {
      "get": {
        "summary": "Iniciar geração de ilustrações com FAL.AI (Modo Assíncrono com Queue + Webhook)",
        "description": "**ARQUIVO:** `webhook-initiate-falai.php` - Inicia o processamento assíncrono de ilustrações para pedidos com status 'created_assets_text' e 'falai_initiated != true'. Utiliza `queue.fal.run/fal-ai/nano-banana-pro/edit` para processar em background e configura webhook automático (campo `webhook_url` no body da requisição) para notificação quando imagens estão prontas. **Arquitetura:** (1) Inicia tarefas no FAL.AI e salva `request_id` no campo `falai_task_id`, (2) FAL.AI processa e chama `/webhook/falai-callback` automaticamente via webhook_url configurado (PRIORITÁRIO e mais rápido), (3) Como fallback, `/webhook-check-falai` faz polling manual de 5 em 5 min. **WEBHOOK_URL:** Campo correto enviado ao FAL.AI para callback automático: `{site_url}/wp-json/trinitykitcms-api/v1/webhook/falai-callback`. **PROMPT:** Prompt profissional para preservar estilo, composição e elementos da ilustração original, aplicando apenas o rosto da criança. **ASPECT_RATIO:** Usa aspect_ratio personalizado de cada página do template (padrão: 16:9). **SKIP_FACESWAP:** Páginas marcadas como `skip_faceswap` copiam ilustração base diretamente. **FALAI_INITIATED:** Campo só é marcado como `true` quando TODAS as páginas (exceto skip_faceswap) tiverem `falai_task_id`. **Cron:** Executa de 5 em 5 minutos. Se faltar task_id, processa novamente (resume de onde parou).",
        "responses": {
          "200": {
            "description": "Tarefas FAL.AI iniciadas com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Processamento assíncrono do FAL.AI concluído. 15 tarefas iniciadas em 3 pedidos."
                    },
                    "initiated_pages": {
                      "type": "integer",
                      "description": "Número total de páginas/tarefas iniciadas",
                      "example": 15
                    },
                    "processed_orders": {
                      "type": "integer",
                      "description": "Número de pedidos processados",
                      "example": 3
                    },
                    "total_orders": {
                      "type": "integer",
                      "description": "Número total de pedidos encontrados",
                      "example": 3
                    },
                    "elapsed_time": {
                      "type": "number",
                      "description": "Tempo de execução em segundos",
                      "example": 45.234
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Lista de erros encontrados (vazia em caso de sucesso)",
                      "example": []
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro no processamento",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Processamento assíncrono do FAL.AI concluído. 8 tarefas iniciadas em 2 pedidos."
                    },
                    "initiated_pages": {
                      "type": "integer",
                      "description": "Número total de páginas/tarefas iniciadas",
                      "example": 8
                    },
                    "processed_orders": {
                      "type": "integer",
                      "description": "Número de pedidos processados",
                      "example": 2
                    },
                    "total_orders": {
                      "type": "integer",
                      "description": "Número total de pedidos encontrados",
                      "example": 3
                    },
                    "elapsed_time": {
                      "type": "number",
                      "description": "Tempo de execução em segundos",
                      "example": 152.456
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "example": "Pedido #123: Imagem base não encontrada para página 1"
                      },
                      "description": "Lista detalhada de erros encontrados"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [{"ApiKeyAuth": []}]
      }
    },
    "/webhook/falai-callback": {
      "post": {
        "summary": "Callback automático do FAL.AI (Webhook) - PRIORITÁRIO",
        "description": "**ARQUIVO DEDICADO:** `webhook-falai-callback.php` - Endpoint chamado automaticamente pelo FAL.AI quando uma imagem é processada e está pronta. Este é o método **PRIORITÁRIO** de recebimento de imagens. **LOGS DETALHADOS:** Registra cada etapa do processamento (recebimento, decodificação JSON, busca do pedido, extração da URL, download, salvamento, ACF, verificação de completude) com prefixo `[TrinityKit FAL.AI CALLBACK]` para debug facilitado. **FLUXO:** (1) Recebe payload com request_id, status e dados da imagem, (2) Busca qual pedido/página corresponde, (3) Faz download e salva no WordPress com metadados profissionais, (4) Atualiza campo ACF `generated_illustration`, (5) Quando todas as páginas estão completas, atualiza status para 'created_assets_illustration'. **Não requer autenticação** pois é chamado pelo FAL.AI. **MÚLTIPLOS FORMATOS:** Suporta diferentes estruturas de payload (output.images[0].url, output.image.url, output.image_url, response_url).",
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["request_id", "status"],
                "properties": {
                  "request_id": {
                    "type": "string",
                    "description": "ID da tarefa FAL.AI (usado para identificar pedido/página)",
                    "example": "abc123def456"
                  },
                  "status": {
                    "type": "string",
                    "description": "Status da tarefa",
                    "enum": ["COMPLETED", "SUCCESS", "FAILED", "ERROR", "IN_QUEUE", "PROCESSING"],
                    "example": "COMPLETED"
                  },
                  "response_url": {
                    "type": "string",
                    "description": "URL para buscar resposta completa (quando aplicável)",
                    "example": "https://queue.fal.run/fal-ai/nano-banana-pro/requests/abc123/response"
                  },
                  "output": {
                    "type": "object",
                    "description": "Dados de saída da API (múltiplos formatos suportados)",
                    "properties": {
                      "images": {
                        "type": "array",
                        "description": "Array de imagens (formato 1: object com url, formato 2: string direta)",
                        "items": {
                          "oneOf": [
                            {
                              "type": "object",
                              "properties": {
                                "url": {
                                  "type": "string",
                                  "description": "URL da imagem gerada",
                                  "example": "https://fal.media/files/abc123.jpg"
                                }
                              }
                            },
                            {
                              "type": "string",
                              "description": "URL direta da imagem",
                              "example": "https://fal.media/files/abc123.jpg"
                            }
                          ]
                        }
                      },
                      "image": {
                        "oneOf": [
                          {
                            "type": "object",
                            "properties": {
                              "url": {
                                "type": "string",
                                "description": "URL da imagem (formato alternativo)",
                                "example": "https://fal.media/files/abc123.jpg"
                              }
                            }
                          },
                          {
                            "type": "string",
                            "description": "URL direta da imagem (formato alternativo)",
                            "example": "https://fal.media/files/abc123.jpg"
                          }
                        ]
                      },
                      "image_url": {
                        "type": "string",
                        "description": "URL da imagem (formato alternativo 3)",
                        "example": "https://fal.media/files/abc123.jpg"
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Callback processado com sucesso ou status não final",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "type": "object",
                      "description": "Imagem processada com sucesso",
                      "properties": {
                        "success": {
                          "type": "boolean",
                          "example": true
                        },
                        "message": {
                          "type": "string",
                          "example": "Image processed successfully"
                        },
                        "order_id": {
                          "type": "integer",
                          "example": 123
                        },
                        "page_index": {
                          "type": "integer",
                          "example": 2
                        },
                        "request_id": {
                          "type": "string",
                          "example": "abc123def456"
                        },
                        "all_complete": {
                          "type": "boolean",
                          "description": "Se todas as páginas do pedido foram completadas",
                          "example": false
                        }
                      }
                    },
                    {
                      "type": "object",
                      "description": "Página já tinha ilustração (ignorado)",
                      "properties": {
                        "message": {
                          "type": "string",
                          "example": "Page already has illustration"
                        },
                        "order_id": {
                          "type": "integer",
                          "example": 123
                        },
                        "page_index": {
                          "type": "integer",
                          "example": 2
                        }
                      }
                    },
                    {
                      "type": "object",
                      "description": "Status não é COMPLETED/SUCCESS (ainda processando ou falhou)",
                      "properties": {
                        "message": {
                          "type": "string",
                          "example": "Status not completed"
                        },
                        "status": {
                          "type": "string",
                          "example": "IN_QUEUE"
                        },
                        "order_id": {
                          "type": "integer",
                          "example": 123
                        },
                        "page_index": {
                          "type": "integer",
                          "example": 2
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Erro de validação ou payload inválido",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "No request_id in payload"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Pedido não encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Order not found for request_id"
                    },
                    "request_id": {
                      "type": "string",
                      "example": "abc123def456"
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro ao processar imagem",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "error": {
                      "type": "string",
                      "example": "Failed to save image"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/webhook/merge-assets": {
      "get": {
        "summary": "Combinar textos e ilustrações em lote",
        "description": "Processa todos os pedidos no status 'created_assets_illustration' para combinar os textos personalizados com as ilustrações processadas. Gera as páginas finais do livro com texto sobreposto nas imagens na metade direita, usando fonte branca com sombra para boa legibilidade.",
        "responses": {
          "200": {
            "description": "Assets combinados com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Processamento de merge concluído. 5 pedidos processados."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos processados com sucesso",
                      "example": 5
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos encontrados",
                      "example": 5
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Lista de erros encontrados (vazia em caso de sucesso)",
                      "example": []
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro no processamento",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Processamento de merge concluído. 3 pedidos processados."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos processados com sucesso",
                      "example": 3
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos encontrados",
                      "example": 5
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "example": "Erro no pedido #123: Falha ao criar imagem mesclada para página 2"
                      },
                      "description": "Lista detalhada de erros encontrados"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [{"ApiKeyAuth": []}]
      }
    },
    "/webhook/generate-pdf": {
      "get": {
        "summary": "Gerar PDFs dos livros personalizados em lote",
        "description": "Processa todos os pedidos no status 'created_assets_merge' para gerar PDFs completos dos livros personalizados. Coleta todas as imagens finais das páginas (final_page_with_text) e cria um PDF profissional com todas as páginas do livro na ordem correta. Após a geração bem-sucedida, atualiza o status do pedido para 'ready_for_delivery'.",
        "responses": {
          "200": {
            "description": "Geração de PDFs concluída com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Processamento de geração de PDF concluído. 3 pedidos processados."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos que tiveram PDFs gerados com sucesso",
                      "example": 3
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos encontrados com status 'created_assets_merge'",
                      "example": 3
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Lista de erros encontrados (vazia em caso de sucesso)",
                      "example": []
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro no processamento",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Processamento de geração de PDF concluído. 2 pedidos processados."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos processados com sucesso",
                      "example": 2
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos encontrados",
                      "example": 3
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "example": "Pedido #123: Páginas finais ausentes: 1, 3"
                      },
                      "description": "Lista detalhada de erros encontrados"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [{"ApiKeyAuth": []}]
      }
    },
    "/orders/{order_id}/deliver": {
      "post": {
        "summary": "Entregar pedido individual",
        "description": "Processa um pedido específico no status 'ready_for_delivery' para enviar email de entrega ao cliente com link para download do PDF final. Após o envio bem-sucedido do email, atualiza o status do pedido para 'delivered' e notifica a equipe via Telegram sobre a entrega realizada. Este endpoint é usado para entrega manual e revisão individual de pedidos.",
        "parameters": [
          {
            "name": "order_id",
            "in": "path",
            "required": true,
            "description": "ID do pedido para entregar",
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Pedido entregue com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Pedido entregue com sucesso"
                    },
                    "order_id": {
                      "type": "integer",
                      "example": 123
                    },
                    "child_name": {
                      "type": "string",
                      "example": "Luna Trindade"
                    },
                    "buyer_name": {
                      "type": "string",
                      "example": "Lucas Trindade"
                    },
                    "buyer_email": {
                      "type": "string",
                      "example": "lucas@email.com"
                    },
                    "pdf_url": {
                      "type": "string",
                      "example": "https://example.com/pdfs/livro-123.pdf"
                    },
                    "status": {
                      "type": "string",
                      "example": "delivered"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Erro de validação ou status inválido",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "invalid_status"
                        },
                        "message": {
                          "type": "string",
                          "example": "Pedido não está pronto para entrega. Status atual: thanked"
                        },
                        "order_id": {
                          "type": "integer",
                          "example": 123
                        },
                        "current_status": {
                          "type": "string",
                          "example": "thanked"
                        },
                        "required_status": {
                          "type": "string",
                          "example": "ready_for_delivery"
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "already_delivered"
                        },
                        "message": {
                          "type": "string",
                          "example": "Pedido já foi entregue anteriormente"
                        },
                        "order_id": {
                          "type": "integer",
                          "example": 123
                        },
                        "current_status": {
                          "type": "string",
                          "example": "delivered"
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "missing_data"
                        },
                        "message": {
                          "type": "string",
                          "example": "Dados obrigatórios ausentes para entrega"
                        },
                        "order_id": {
                          "type": "integer",
                          "example": 123
                        },
                        "missing": {
                          "type": "object",
                          "properties": {
                            "buyer_name": {
                              "type": "boolean",
                              "example": false
                            },
                            "buyer_email": {
                              "type": "boolean",
                              "example": false
                            },
                            "pdf_url": {
                              "type": "boolean",
                              "example": true
                            }
                          }
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "invalid_email"
                        },
                        "message": {
                          "type": "string",
                          "example": "Email inválido: invalid@"
                        },
                        "order_id": {
                          "type": "integer",
                          "example": 123
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "404": {
            "description": "Pedido não encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "code": {
                      "type": "string",
                      "example": "order_not_found"
                    },
                    "message": {
                      "type": "string",
                      "example": "Pedido não encontrado"
                    },
                    "order_id": {
                      "type": "integer",
                      "example": 123
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro interno do servidor",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "email_send_failed"
                        },
                        "message": {
                          "type": "string",
                          "example": "Falha ao enviar email de entrega"
                        },
                        "order_id": {
                          "type": "integer",
                          "example": 123
                        },
                        "error_details": {
                          "type": "string",
                          "example": "SMTP Error: Could not connect to SMTP host"
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "status_update_failed"
                        },
                        "message": {
                          "type": "string",
                          "example": "Email enviado, mas falha ao atualizar status para delivered"
                        },
                        "order_id": {
                          "type": "integer",
                          "example": 123
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {
                        "code": {
                          "type": "string",
                          "example": "unexpected_error"
                        },
                        "message": {
                          "type": "string",
                          "example": "Erro inesperado na entrega do pedido #123: Exception message"
                        },
                        "order_id": {
                          "type": "integer",
                          "example": 123
                        }
                      }
                    }
                  ]
                }
              }
            }
          }
        },
        "security": [{"ApiKeyAuth": []}]
      }
    },
    "/webhook/deliver-pdf": {
      "get": {
        "summary": "Entregar PDFs dos livros personalizados aos clientes (em lote)",
        "description": "Processa todos os pedidos no status 'ready_for_delivery' para enviar emails de entrega aos clientes com links para download dos PDFs finais. Após o envio bem-sucedido do email, atualiza o status do pedido para 'delivered' e notifica a equipe via Telegram sobre a entrega realizada.",
        "responses": {
          "200": {
            "description": "Entrega de PDFs concluída com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Processamento de entrega de PDFs concluído. 3 pedidos entregues."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos que foram entregues com sucesso",
                      "example": 3
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos encontrados com status 'ready_for_delivery'",
                      "example": 3
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Lista de erros encontrados (vazia em caso de sucesso)",
                      "example": []
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Erro no processamento",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Processamento de entrega de PDFs concluído. 2 pedidos entregues."
                    },
                    "processed": {
                      "type": "integer",
                      "description": "Número de pedidos entregues com sucesso",
                      "example": 2
                    },
                    "total": {
                      "type": "integer",
                      "description": "Número total de pedidos encontrados",
                      "example": 3
                    },
                    "errors": {
                      "type": "array",
                      "items": {
                        "type": "string",
                        "example": "Pedido #123: Email inválido: email@invalido"
                      },
                      "description": "Lista detalhada de erros encontrados"
                    }
                  }
                }
              }
            }
          }
        },
        "security": [{"ApiKeyAuth": []}]
      }
    }
  },
  "components": {
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key"
      }
    },
    "schemas": {
      "TaxonomyTerm": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "description": "ID do termo"
          },
          "name": {
            "type": "string",
            "description": "Nome do termo"
          },
          "slug": {
            "type": "string",
            "description": "Slug do termo"
          },
          "children": {
            "type": "array",
            "description": "Termos filhos",
            "items": {
              "$ref": "#/components/schemas/TaxonomyTerm"
            }
          }
        }
      }
    }
  }
}